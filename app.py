from flask import Flask, request, send_file, jsonify
from gtts import gTTS
import os
from datetime import datetime

app = Flask(__name__)

def translate_to_english(text):
    translations = {
        "မင်္ဂလာပါ": "Hello",
        "နေကောင်းလား": "Are you well?",
        "ကျေးဇူးပါ": "Thank you",
        "ဘာလုပ်လို့ရလဲ": "What can you do?",
        "ဘယ်ကလာလဲ": "Where are you from?",
        "အခုဘယ်နာရီလဲ": "What time is it now?",
        "ဒီနေ့ ရာသီဥတု ဘယ်လိုလဲ": "How's the weather today?",
        "ဘာစားရမလဲ": "What should I eat?",
        "ဘယ်မှာလဲ": "Where are you?",
        "ဘယ်လိုလဲ": "How are you?",
        "အိပ်ချင်တယ်": "I'm sleepy",
        "ပျော်တယ်": "I'm happy",
        "ဘာလုပ်နေလဲ": "What are you doing?",
        "ဘယ်လောက်ကျလဲ": "How much does it cost?",
        "ဘယ်သူလဲ": "Who are you?",
        "ဘာလိုချင်လဲ": "What do you want?",
        "ဘယ်နေ့လဲ": "What day is it?"
    }
    return translations.get(text.strip(), "ဒီစာကို ဘာသာမပြန်နိုင်သေးပါဘူး။ တခြား စာကြောင်း ပြောပြပါ။")

def get_weather(city):
    weather_data = {
        "ရန်ကုန်": "ဒီနေ့ ရန်ကုန်မှာ မိုးအနည်းငယ် ရွာနိုင်ပါတယ်။ အပူချိန် ၃၀ ဒီဂရီရှိပါတယ်။",
        "မန္တလေး": "ဒီနေ့ မန္တလေးမှာ နေပူပြီး အပူချိန် ၃၅ ဒီဂရီရှိပါတယ်။",
        "နေပြည်တော်": "ဒီနေ့ နေပြည်တော်မှာ တိမ်အနည်းငယ်ရှိပြီး အပူချိန် ၃၂ ဒီဂရီရှိပါတယ်။",
        "မော်လမြိုင်": "ဒီနေ့ မော်လမြိုင်မှာ မိုးရွာပြီး အပူချိန် ၂၈ ဒီဂရီရှိပါတယ်။",
        "တောင်ကြီး": "ဒီနေ့ တောင်ကြီးမှာ အေးမြပြီး အပူချိန် ၂၂ ဒီဂရီရှိပါတယ်။",
        "မုံရွာ": "ဒီနေ့ မုံရွာမှာ နေသာပြီး အပူချိန် ၃၄ ဒီဂရီရှိပါတယ်။",
        "ပုဂံ": "ဒီနေ့ ပုဂံမှာ နေပူပြီး အပူချိန် ၃၆ ဒီဂရီရှိပါတယ်။",
        "မြစ်ကြီးနား": "ဒီနေ့ မြစ်ကြီးနားမှာ အေးပြီး အပူချိန် ၂၀ ဒီဂရီရှိပါတယ်။",
        "လားရှိုး": "ဒီနေ့ လားရှိုးမှာ အေးမြပြီး အပူချိန် ၂၃ ဒီဂရီရှိပါတယ်။",
        "ထားဝယ်": "ဒီနေ့ ထားဝယ်မှာ မိုးရွာပြီး အပူချိန် ၂၇ ဒီဂရီရှိပါတယ်။",
        "ဘားအံ": "ဒီနေ့ ဘားအံမှာ မိုးအနည်းငယ် ရွာနိုင်ပြီး အပူချိန် ၂၉ ဒီဂရီရှိပါတယ်။",
        "ဟားခါး": "ဒီနေ့ ဟားခါးမှာ အေးပြီး အပူချိန် ၁၈ ဒီဂရီရှိပါတယ်။",
        "စစ်တွေ": "ဒီနေ့ စစ်တွေမှာ မိုးရွာပြီး အပူချိန် ၂၆ ဒီဂရီရှိပါတယ်။",
        "လွိုင်ကော်": "ဒီနေ့ လွိုင်ကော်မှာ အေးမြပြီး အပူချိန် ၂၄ ဒီဂရီရှိပါတယ်။"
    }
    return weather_data.get(city.strip(), "ဒီမြို့ရဲ့ ရာသီဥတုကို မသိသေးပါဘူး။ မြို့အမည်ကို ပြောပြပါ။")

def get_myanmar_info(place):
    myanmar_data = {
        "ရန်ကုန်တိုင်းဒေသကြီး": "မြို့တော်က ရန်ကုန်မြို့ပါ။ လူဦးရေ ၇ သန်းကျော်ရှိပြီး မြန်မာနိုင်ငံရဲ့ စီးပွားရေး ဗဟိုချက်ပါ။ ရာသီဥတုက ပူပြီး စိုစွတ်ပါတယ်။",
        "မန္တလေးတိုင်းဒေသကြီး": "မြို့တော်က မန္တလေးမြို့ပါ။ လူဦးရေ ၆ သန်းကျော်ရှိပြီး ယဉ်ကျေးမှု အမွေအနှစ်တွေ ကြွယ်ဝပါတယ်။ ရာသီဥတုက ပူပြီး ခြောက်သွေ့တတ်ပါတယ်။",
        "နေပြည်တော်တိုင်းဒေသကြီး": "မြို့တော်က နေပြည်တော်ပါ။ မြန်မာနိုင်ငံရဲ့ မြို့တော်ဖြစ်ပြီး လူဦးရေ ၁ သန်းကျော်ရှိပါတယ်။ ရာသီဥတုက ပူပြီး မိုးများတတ်ပါတယ်။",
        "ဧရာဝတီတိုင်းဒေသကြီး": "မြို့တော်က ပုသိမ်မြို့ပါ။ လူဦးရေ ၆ သန်းကျော်ရှိပြီး ဆန်စပါး ထုတ်လုပ်မှု များပါတယ်။ ရာသီဥတုက စိုစွတ်ပြီး မိုးများပါတယ်။",
        "ပဲခူးတိုင်းဒေသကြီး": "မြို့တော်က ပဲခူးမြို့ပါ။ လူဦးရေ ၄ သန်းကျော်ရှိပြီး စိုက်ပျိုးရေး ထွန်းကားပါတယ်။ ရာသီဥတုက ပူပြီး မိုးများတတ်ပါတယ်။",
        "မကွေးတိုင်းဒေသကြီး": "မြို့တော်က မကွေးမြို့ပါ။ လူဦးရေ ၃ သန်းကျော်ရှိပြီး မြေနီစေး ထွက်ရှိပါတယ်။ ရာသီဥတုက ပူပြီး ခြောက်သွေ့တတ်ပါတယ်။",
        "စစ်ကိုင်းတိုင်းဒေသကြီး": "မြို့တော်က စစ်ကိုင်းမြို့ပါ။ လူဦးရေ ၅ သန်းကျော်ရှိပြီး သမိုင်းဝင် နေရာတွေ ရှိပါတယ်။ ရာသီဥတုက ပူပြီး မိုးများတတ်ပါတယ်။",
        "ကချင်ပြည်နယ်": "မြို့တော်က မြစ်ကြီးနားပါ။ လူဦးရေ ၁.၇ သန်းကျော်ရှိပြီး ကျောက်စိမ်းထွက်ပါတယ်။ ရာသီဥတုက အေးမြပြီး မိုးများပါတယ်။",
        "ကယားပြည်နယ်": "မြို့တော်က လွိုင်ကော်ပါ။ လူဦးရေ ၃ သိန်းကျော်ရှိပြီး တောင်တန်းဒေသပါ။ ရာသီဥတုက အေးမြတတ်ပါတယ်။",
        "ကရင်ပြည်နယ်": "မြို့တော်က ဘားအံပါ။ လူဦးရေ ၁.၅ သန်းကျော်ရှိပြီး တောအုပ်များပါတယ်။ ရာသီဥတုက စိုစွတ်ပြီး မိုးများပါတယ်။",
        "ချင်းပြည်နယ်": "မြို့တော်က ဟားခါးပါ။ လူဦးရေ ၅ သိန်းကျော်ရှိပြီး တောင်တန်းဒေသပါ။ ရာသီဥတုက အေးမြတတ်ပါတယ်။",
        "မွန်ပြည်နယ်": "မြို့တော်က မော်လမြိုင်ပါ။ လူဦးရေ ၂ သန်းကျော်ရှိပြီး ပင်လယ်ကမ်းခြေရှိပါတယ်။ ရာသီဥတုက စိုစွတ်ပြီး မိုးများပါတယ်။",
        "ရခိုင်ပြည်နယ်": "မြို့တော်က စစ်တွေပါ။ လူဦးရေ ၃ သန်းကျော်ရှိပြီး သမိုင်းဝင် မြို့ဟောင်းတွေ ရှိပါတယ်။ ရာသီဥတုက စိုစွတ်ပြီး မိုးများပါတယ်။",
        "ရှမ်းပြည်နယ်": "မြို့တော်က တောင်ကြီးပါ။ လူဦးရေ ၅ သန်းကျော်ရှိပြီး တောင်တန်းဒေသ ကြီးပါ။ ရာသီဥတုက အေးမြတတ်ပါတယ်။"
    }
    return myanmar_data.get(place.strip(), "ဒီနေရာကို မသိသေးပါဘူး။ ပြည်နယ် ဒါမှမဟုတ် တိုင်းဒေသကြီး အမည်ကို ပြောပြပါ။")

def get_custom_response(message):
    message = message.strip().lower()
    
    # အချိန်နဲ့ ရက်စွဲ မေးခွန်းများ
    if "အခုဘယ်နာရီလဲ" in message or "အချိန်" in message:
        current_time = datetime.now().strftime("%H:%M:%S")
        return f"အခုအချိန်က {current_time} ပါ။"
    if "ဒီနေ့ ဘယ်နေ့လဲ" in message or "ရက်စွဲ" in message:
        current_date = datetime.now().strftime("%Y-%m-%d")
        return f"ဒီနေ့က {current_date} ပါ။ မြန်မာပြက္ခဒိန်ကို မသိသေးလို့ အနောက်ပြက္ခဒိန်နဲ့ပဲ ဖြေပေးလိုက်ပါတယ်။"
    
    # ရာသီဥတု မေးခွန်းများ
    if "ရာသီဥတု" in message:
        city = message.replace("ဒီနေ့", "").replace("ရာသီဥတု", "").replace("ဘယ်လိုလဲ", "").strip()
        if city:
            return get_weather(city)
        return "ဘယ်မြို့ရဲ့ ရာသီဥတုကို သိချင်လဲ ပြောပြပါ။"
    
    # ဘာသာပြန် မေးခွန်းများ
    if "အင်္ဂလိပ်လို ပြန်ပေး" in message or "ဘာသာပြန်" in message:
        text_to_translate = message.replace("အင်္ဂလိပ်လို ပြန်ပေး", "").replace("ဘာသာပြန်", "").strip()
        if text_to_translate:
            return translate_to_english(text_to_translate)
        return "ဘာကို ဘာသာပြန်ပေးရမလဲ ပြောပြပါ။"
    
    # မြန်မာနိုင်ငံ အချက်အလက် မေးခွန်းများ
    if "မြန်မာနိုင်ငံ" in message and "ပြည်နယ်" in message or "တိုင်း" in message:
        if "ဘယ်ပြည်နယ်" in message or "ဘယ်တိုင်း" in message:
            return "မြန်မာနိုင်ငံမှာ ပြည်နယ် ၇ ခုနဲ့ တိုင်းဒေသကြီး ၇ ခု ရှိပါတယ်။ ပြည်နယ်တွေက - ကချင်၊ ကယား၊ ကရင်၊ ချင်း၊ မွန်၊ ရခိုင်၊ ရှမ်း။ တိုင်းဒေသကြီးတွေက - ရန်ကုန်၊ မန္တလေး၊ နေပြည်တော်၊ ဧရာဝတီ၊ ပဲခူး၊ မကွေး၊ စစ်ကိုင်း။ ဘယ်ဟာအကြောင်း သိချင်လဲ?"
        place = message.replace("မြန်မာနိုင်ငံ", "").replace("အကြောင်း", "").replace("ပြောပြပါ", "").strip()
        if place:
            return get_myanmar_info(place)
        return "မြန်မာနိုင်ငံအကြောင်း ဘာသိချင်လဲ? ပြည်နယ် ဒါမှမဟုတ် တိုင်းဒေသကြီး တစ်ခုခုကို ပြောပြပါ။"
    
    # နေ့စဉ်သုံး စကားပြောများ
    responses = {
        "မင်္ဂလာပါ": "မင်္ဂလာပါ။ PPH AI မှ ကြိုဆိုပါတယ်။ ဘာကူညီပေးရမလဲ?",
        "ဟိုင်း": "ဟိုင်း။ ဘာလဲလို့ မေးကြည့်ရမလား?",
        "နေကောင်းလား": "ကျွန်တော် နေကောင်းပါတယ်။ သင်ရော နေကောင်းလား?",
        "ကျေးဇူးပါ": "ရပါတယ်။ နောက်ထပ် ဘာကူညီပေးရမလဲ?",
        "ဘာမှမသိဘူး": "စိတ်မပူပါနဲ့။ သင်သိချင်တာ ဘာလဲဆိုတာ ပြောပြရင် ကျွန်တော် ရှင်းပြပေးမယ်။",
        "သွားတော့မယ်": "အိုကေ။ နောက်တစ်ခါ ပြန်တွေ့မယ်နော်။ ဂရုစိုက်ပါ။",
        "ဂွတ်ဘိုင်": "ဂွတ်ဘိုင်။ နောက်မှ ထပ်ဆုံကြမယ်။",
        "ဘယ်သူလဲ": "ကျွန်တော်က PPH AI စကားပြောစက်ပါ။ သင့်ကို ကူညီဖို့ ဖန်တီးထားတာပါ။",
        "ဘာလုပ်လို့ရလဲ": "ကျွန်တော်က မေးခွန်းတွေ ဖြေပေးနိုင်တယ်၊ စကားပြောနိုင်တယ်၊ အချက်အလက် ရှာပေးနိုင်တယ်၊ ဘာသာပြန်ပေးနိုင်တယ်၊ ရာသီဥတု ပြောပြပေးနိုင်တယ်။ ဘာလုပ်ချင်လဲ?",
        "ဘယ်ကလာလဲ": "ကျွန်တော်က ဒစ်ဂျစ်တယ် ကမ္ဘာက လာတာပါ။ PPH AI လို့ ခေါ်တဲ့ နေရာမျိုးက ဖန်တီးထားတာပါ။",
        "ဘယ်လောက်သိလဲ": "ကျွန်တော်က အများကြီး သိအောင် လေ့ကျင့်ထားပါတယ်။ သင်မေးတာကို ဖြေကြည့်လို့ရပါတယ်။",
        "ဘာစားရမလဲ": "ဒီနေ့ ထမင်းနဲ့ ကြက်ဥကြော် စားကြည့်ပါလား။ အရသာရှိတယ်။ တခြား ဘာစားချင်လဲ?",
        "ဘယ်မှာလဲ": "ကျွန်တော်က ဒစ်ဂျစ်တယ်ထဲမှာ ရှိတယ်။ သင်ဘယ်မှာ ရှိလဲ?",
        "ဘယ်လိုလဲ": "ကျွန်တော် အဆင်ပြေပါတယ်။ သင်ရော ဘယ်လိုလဲ?",
        "အိပ်ချင်တယ်": "အိပ်ချင်ရင် အနားယူလိုက်ပါ။ အိပ်မက်လှလှ မက်ပါစေ။",
        "ပျော်တယ်": "ပျော်တာ ကောင်းပါတယ်။ ဘာကြောင့် ပျော်တာလဲ ပြောပြပါလား?",
        "ဘာလုပ်နေလဲ": "ကျွန်တော်က သင်နဲ့ စကားပြောနေတာပါ။ သင်ရော ဘာလုပ်နေလဲ?",
        "ဘယ်လောက်ကျလဲ": "ဘာကို ဆိုလိုတာလဲ ပြောပြပါ။ ဥပမာ တစ်ခုခု ဝယ်ဖို့လား?",
        "ဘာလိုချင်လဲ": "ကျွန်တော်က သင့်ကို ကူညီချင်ပါတယ်။ သင်က ဘာလိုချင်လဲ?",
        "ဘယ်နေ့လဲ": "ဒီနေ့က ဘယ်နေ့လဲ သိချင်ရင် အပေါ်မှာ မေးလို့ရတယ်နော်။ တခြား ဘာကို ဆိုလိုတာလဲ?",
        "ဘာဖြစ်လဲ": "ဘာမှ မဖြစ်ပါဘူး။ သင်ရော ဘာဖြစ်လဲ?",
        "ပိုက်ဆံမရှိဘူး": "ပိုက်ဆံမရှိရင် စိတ်မပူပါနဲ့။ ကျွန်တော်က အခမဲ့ ကူညီပေးမယ်။",
        "အကူအညီလိုတယ်": "အကူအညီလိုရင် ပြောပါ။ ဘာနဲ့ ကူညီပေးရမလဲ?",
        "ဘာကြည့်ရမလဲ": "ဒီနေ့ မြန်မာ ဇာတ်လမ်းတွေ ကြည့်ကြည့်ပါလား။ တခြား ဘာကြည့်ချင်လဲ?",
        "ဘယ်သွားရမလဲ": "ဘယ်သွားချင်လဲ ပြောပြပါ။ အကြံပေးလို့ ရပါတယ်။"
    }
    return responses.get(message, "သင်ပြောတာကို နားမလည်ဘူး။ နောက်တစ်ခါ ပြန်ပြောပြပါ။ ဘာကူညီပေးရမလဲ?")

@app.route('/')
def index():
    return send_file('index.html')

@app.route('/speak', methods=['POST'])
def speak():
    text = request.form.get('text')
    if not text:
        return jsonify({"error": "No text provided"}), 400
    response = get_custom_response(text)
    try:
        tts = gTTS(text=response, lang='my', slow=False)
        audio_file = "static/response.mp3"
        tts.save(audio_file)
        return send_file(audio_file, mimetype="audio/mp3")
    except Exception as e:
        return jsonify({"error": str(e)}), 500

@app.route('/response', methods=['POST'])
def response():
    text = request.form.get('text')
    if not text:
        return jsonify({"error": "No text provided"}), 400
    response_text = get_custom_response(text)
    return jsonify({"response": response_text})

if __name__ == '__main__':
    if not os.path.exists('static'):
        os.makedirs('static')
    app.run(debug=True, host='0.0.0.0', port=5000)  # Port 80 ဖွင့်ချင်ရင် 80 ပြောင်းပါ